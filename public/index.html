<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <style type="text/css">
        body {
            font-family: "lucida grande",
            "lucida sans unicode",
            lucida,
            helvetica,
            "Hiragino Sans GB",
            "Microsoft YaHei",
            "WenQuanYi Micro Hei",
            sans-serif;
        }

        @font-face {
            font-family: "Material Icons";
            font-style: normal;
            font-weight: 400;
            src: url(fonts/flUhRq6tzZclQEJ-Vdg-IuiaDsNc.woff2) format('woff2');
        }

        .material-icons {
            font-family: 'Material Icons';
            font-weight: normal;
            font-style: normal;
            font-size: 24px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
        }

        body {
            display: flex;
            min-height: 100vh;
            flex-direction: column;
        }

        main {
            flex: 1 0 auto;
        }

        .logo-blue {
            background-color: rgb(0, 161, 241) !important;
        }

    </style>
    <link rel="stylesheet" href="css/materialize.min.css">

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>北京邮电大学 - 2018级本科新生易班认证平台</title>
</head>

<body>

<header>
    <div class="top-nav logo-blue">

        <div class="nav-wrapper">
            <a class="brand-logo" href=""><img src="pic/logo.gif" class="img-responsive"></a>
            <ul id="nav-mobile" class="right">
                <h1 class="header" style="color:white;letter-spacing:4px">易班认证平台</h1>
            </ul>

        </div>

    </div>
</header>

<main class="valign-wrapper">

    <div class="container">
        <div class="login-content">
            <div class="row">
                <div class="input-field col s6 offset-s3">
                    <i class="material-icons prefix">account_circle</i>
                    <input placeholder="姓名" id="name" type="text" class="validate">
                    <label for="name">姓名</label>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s6 offset-s3">
                    <i class="material-icons prefix">fingerprint</i>
                    <input placeholder="身份证号" id="prc_id" type="password" class="validate">
                    <label for="prc_id">身份证号</label>
                </div>
            </div>
            <div class="row">
                <div class="input-field col s6 offset-s3">
                    <button id="submit-button" class="col s12 btn waves-effect waves-light" type="submit" name="action">
                        登陆
                        <i class="material-icons right">send</i>
                    </button>
                    <div class="progress hide">
                        <div class="indeterminate"></div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <div id="redirect">

    </div>

</main>

<footer class="page-footer logo-blue">
    <div class="footer-copyright">
        <div class="container">
            © 2018 北京邮电大学易班发展中心
        </div>
    </div>
</footer>

<script src="js/jquery-3.3.1.min.js"></script>
<script src="js/materialize.min.js"></script>

<script>

    function check_form() {
        return document.getElementById('name').value.length > 0
            && document.getElementById('prc_id').value.length > 0;
    }

    function restore_button() {
        $('.progress').addClass('hide');
        $('#submit-button').removeClass('disabled');
    }

    window.onload = function () {
        document.getElementById('submit-button').onclick = function () {
            if (!check_form()) {
                M.toast({html: "姓名与身份证号不能为空"});
                return;
            }

            $('.progress').removeClass('hide');
            $('#submit-button').addClass('disabled');

            $.ajax({
                url: 'check.php',
                method: 'POST',
                data: {
                    name: document.getElementById('name').value,
                    prc_id: document.getElementById('prc_id').value
                }
            }).fail(function() {
                restore_button();
            }).done(function(rp) {
                var rj = JSON.parse(rp);
                if (!rj.ok) {
                    M.toast({html: rj.msg});
                    restore_button();
                    return;
                }
                document.getElementById('redirect').innerHTML = rj.html;
                eval(rj.script);
                restore_button();
            });

        };
    };
</script>

</body>
</html>
